<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Lá»‹ch ThÃ¡ng 12</title>

<style>
/* --- Äá»ŠNH NGHÄ¨A BIáº¾N CSS (CUSTOM PROPERTIES) --- */
:root {
    /* MÃ u chÃ­nh theo loáº¡i giáº£i */
    --color-ocg: #c62828;
    --color-ae: #2e7d32;
    --color-tnt: #f57f17;
    --color-genesys: #1976d2;
    --color-nexus: #00acc1;
    --color-edison: #ff9800;
    --color-tour: #9c27b0;
    --color-hof: red;

    /* Background nháº¡t theo loáº¡i giáº£i */
    --bg-ocg: #ffcdd2;
    --bg-ae: #c8e6c9;
    --bg-tnt: #fff9c4;
    --bg-genesys: #bbdefb;
    --bg-nexus: #e0f7fa;
    --bg-edison: #fff3e0;
    --bg-tour: #f3e5f5;
    --bg-hof: #ffecec;
    /* Status colors */
    --status-not-started: #0d47a1;
    --status-ongoing: #1b5e20;
    --status-finished: #b71c1c;
    /* RGBA overlays for background tint based on status */
    --status-not-started-rgba: rgba(13,71,161,0.06);
    --status-ongoing-rgba: rgba(27,94,32,0.08);
    --status-finished-rgba: rgba(183,28,28,0.06);
}

/* â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” GENERAL BACKGROUND â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” */
body {
    font-family: 'Segoe UI', sans-serif;
    background: url('https://i.postimg.cc/MpfwkmQj/TNT_24.png') center/cover fixed;
    padding: 20px;
    margin: 0;
}

/* â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” HEADER (T2â€“CN) â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” */
.header-row {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    max-width: 1200px;
    margin: 0 auto 6px;
    text-align: center;
    font-weight: bold;
    color: white;
    text-transform: uppercase;
    letter-spacing: 1px;
}
.header-cell {
    background: rgba(0,0,0,0.75);
    padding: 10px 0;
    border-radius: 6px;
}
.sat { 
    background: rgba(255,204,0,0.75); color:#000; 
    padding: 10px 0;
    border-radius: 6px;
}
.sun { 
    background: rgba(255,59,48,0.75); color:white; 
    padding: 10px 0;
    border-radius: 6px;
}

/* â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” GRID CALENDAR â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” */
.calendar {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 4px;
    max-width: 1200px;
    margin: auto;
}
.day {
    background: rgba(255,255,255,0.95);
    border-radius: 8px;
    padding: 8px;
    min-height: 110px;
    display: flex;
    flex-direction: column;
}
.other { background: rgba(74, 74, 74, 0.809) !important; color:#777 !important; }

/* â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” GRID ITEM ANIMATIONS â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” */

/* hiá»‡u á»©ng load vÃ o */
.day {
    opacity: 0;
    transform: translateY(8px);
    animation: dayFadeIn 0.45s ease forwards;
}

/* táº¡o trá»… nhá» cho tá»«ng Ã´ â†’ hiá»‡u á»©ng lan tá»a */
.day:nth-child(1) { animation-delay: .02s; }
.day:nth-child(2) { animation-delay: .04s; }
.day:nth-child(3) { animation-delay: .06s; }
.day:nth-child(4) { animation-delay: .08s; }
.day:nth-child(5) { animation-delay: .10s; }
.day:nth-child(6) { animation-delay: .12s; }
.day:nth-child(7) { animation-delay: .14s; }
/* Tá»± Ä‘á»™ng láº·p láº¡i thÃªm náº¿u cáº§n */
.day:nth-child(14) { animation-delay: .16s; }
.day:nth-child(21) { animation-delay: .18s; }
.day:nth-child(28) { animation-delay: .20s; }

@keyframes dayFadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to   { opacity: 1; transform: translateY(0); }
}

/* hiá»‡u á»©ng hover â€“ chá»‰ desktop */
@media (hover:hover) {
    .day:hover {
        transform: translateY(-3px);
        box-shadow: 0 6px 14px rgba(0,0,0,0.22);
        transition: .25s ease;
        z-index: 2;
    }
}

.past {
    opacity: 0.6 !important;
    background: rgba(134, 134, 134, 0.7) !important;
    color: white !important;
    text-decoration: line-through;
    text-decoration-thickness: 2px;
}

.today {
    border: 3px solid #4caf50;
    background: rgba(200,255,200,0.95);
}

.day-number {
    font-size: 1.4em;
    font-weight: 800;
    margin-bottom: 6px;
}

.day:nth-child(7n) .day-number { color:#c62828; }
.day:nth-child(7n-1) .day-number { color:#fbc02d; }

/* â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” EVENT STYLES â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” */
.note {
    margin-top: 4px;
    padding: 4px 6px;
    border-radius: 6px;
    display: flex;
    align-items: center;
    gap: 2px;
    cursor: pointer;
    font-size: .85em;
    font-weight: 600;
    transition: .2s;
    word-break: break-word;
}

/* FIX: prevent items sticking to the right edge */
/* Desktop only */
@media(min-width:769px){
    .note {
        justify-content: space-between;
        padding-right: 10px;
    }
}

/* Mobile: Ä‘áº·t láº¡i chuáº©n Ä‘á»ƒ khÃ´ng bá»‹ dáº¡t pháº£i */
@media(max-width:768px){
    .note {
        justify-content: flex-start;
        gap: 6px;
        padding-right: 6px;
    }
}

/* ensure tag isn't hugging the right border */
.note .tag {
    margin-left: 6px !important;
}

.note:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,.18); }

/* make the event name take remaining space so tag pushes to right */
.note .name {
    display: inline-block;
    line-height: 1.15;
    flex: 1 1 auto; /* allow the name to grow and wrap */
    min-width: 0; /* prevent overflow when long */
    overflow-wrap: break-word;
}

/* TAG (badge) styling: white background, colored border and text from type */
.note .tag {
    padding: 2px 4px;
    border-radius: 6px;
    font-size: .75em;
    font-weight: 700;
    white-space: nowrap;
    background: #fff;            /* ensure white background */
    display: inline-flex;
    align-items: center;
    justify-content: center;
    border: 1px solid transparent; 
    color: inherit;             /* we'll override per type if needed */
}

@media(max-width:768px){
    .note .tag {
        margin-left: 4px !important;
    }
}

/* NOTE: time is displayed only in preview and popup, not in the note. */

/* make stream icon sit left and not affect flex */
.stream-icon {
    font-size: 1.05em;
    flex: 0 0 auto;
    margin-right: 6px;
    line-height: 1;
}

/* COLORS BY TYPE (sá»­ dá»¥ng biáº¿n CSS) */
.ocg { background:var(--bg-ocg); color:var(--color-ocg); border-left:5px solid var(--color-ocg); }
.ocg .tag { border-color: var(--color-ocg); color: var(--color-ocg); }

.ae { background:var(--bg-ae); color:var(--color-ae); border-left:5px solid var(--color-ae); }
.ae .tag { border-color: var(--color-ae); color: var(--color-ae); }

.tnt { background:var(--bg-tnt); color:var(--color-tnt); border-left:5px solid var(--color-tnt); }
.tnt .tag { border-color: var(--color-tnt); color: var(--color-tnt); }

.genesys { background:var(--bg-genesys); color:var(--color-genesys); border-left:5px solid var(--color-genesys); }
.genesys .tag { border-color: var(--color-genesys); color: var(--color-genesys); }

.nexus { background:var(--bg-nexus); color:var(--color-nexus); border-left:5px solid var(--color-nexus); }
.nexus .tag { border-color: var(--color-nexus); color: var(--color-nexus); }

.edison { background:var(--bg-edison); color:var(--color-edison); border-left:5px solid var(--color-edison); }
.edison .tag { border-color: var(--color-edison); color: var(--color-edison); }

.tour { background:var(--bg-tour); color:var(--color-tour); border-left:5px solid var(--color-tour); }
.tour .tag { border-color: var(--color-tour); color: var(--color-tour); }

.hof {
    background:var(--bg-hof);
    animation:pulse 1.3s infinite;
    color: var(--color-hof);
    border-left: 5px solid var(--color-hof);
}
.hof .tag { border-color: var(--color-hof); color: var(--color-hof); }

@keyframes pulse { 0%{transform:scale(1)} 50%{transform:scale(1.03)} 100%{transform:scale(1)} }

/* â€”â€”â€” PREVIEW ON HOVER â€”â€”â€” */
.preview-box {
    position: fixed;
    background: rgba(0,0,0,0.85);
    color: white;
    padding: 10px 12px;
    border-radius: 10px;
    font-size: 13px;
    max-width: 240px;
    line-height: 1.4;
    z-index: 999;
    pointer-events: none;
    opacity: 0;
    transform: translateY(6px);
    transition: .15s ease;
    box-shadow: 0 6px 14px rgba(0,0,0,.45);
}
.preview-box.show {
    opacity: 1;
    transform: translateY(0);
}

/* Gallery inside popup */
.gallery {
    display: flex;
    gap: 8px;
    overflow-x: auto;
    padding: 6px 4px;
}
.gallery img {
    max-height: 150px;
    border-radius: 6px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.2);
}
.gallery .empty {
    color: #666;
    font-size: 0.95em;
}

/* â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” POPUP â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” */
.popup-bg {
    position:fixed; inset:0;
    background:rgba(0,0,0,0.65);
    display:flex; justify-content:center; align-items:center;
    z-index:20;
    opacity: 0;
    pointer-events: none;
    transition: opacity 220ms ease;
}
.popup-bg.show {
    opacity: 1;
    pointer-events: auto;
}

/* Generic popup (kept for backward compatibility) */
.popup {
    background:white;
    padding:20px;
    border-radius:12px;
    width:300px;
}

/* Book-style popup transitions */
.book-popup {
    background: white;
    padding: 20px;
    border-radius: 14px;
    width: 340px;
    perspective: 1000px;
    transform: translateY(8px) scale(0.98);
    opacity: 0;
    transition: transform 220ms cubic-bezier(.2,.9,.2,1), opacity 180ms ease;
}
.book-popup.show {
    transform: translateY(0) scale(1);
    opacity: 1;
}

/* Popup content rows */
.popup-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 12px;
    margin: 8px 0;
    font-size: 0.98em;
}
.popup-row .label { color: #666; font-weight: 700; }
.popup-row .value { color: #222; font-weight: 600; }
.popup-row .value .tag { font-size: .85em; padding: 3px 6px; }
.watch-btn { display:inline-block; margin-left:8px; padding:4px 8px; border-radius:6px; background:#1976d2; color:white; text-decoration:none; font-weight:700; font-size:.9em; }
.watch-btn[disabled]{ opacity: .5; pointer-events: none; }

@keyframes fade { from{opacity:0; transform:translateY(10px)} to{opacity:1;} }

/* â€”â€”â€”â€”â€”â€”â€”â€”â€” BOOK STYLE POPUP â€”â€”â€”â€”â€”â€”â€”â€”â€” */
.book-popup {
    background: white;
    padding: 20px;
    border-radius: 14px;
    width: 340px;
    perspective: 1000px;
}

.book {
    position: relative;
}

.page {
    position: relative;
    width: 100%;
    height: 180px;
    margin-bottom: 15px;
    transform-style: preserve-3d;
    transition: opacity 160ms ease;
    cursor: default;
}


.page { display: none; }
.page.active { display: block; }

.page .front, 
.page .back {
    position: absolute;
    width: 100%;
    height: 100%;
    backface-visibility: hidden;
    border-radius: 12px;
    padding: 16px;
    box-sizing: border-box;
    background: #fafafa;
    border: 1px solid #ddd;
}

.page .back {
    transform: rotateY(180deg);
    background: #eaeaea;
}

.close-book {
    text-align: center;
    margin-top: 10px;
}

.close-book button {
    padding: 6px 14px;
    border-radius: 8px;
    border: none;
    background: #333;
    color: white;
    cursor: pointer;
}

/* â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” FILTER â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” */
.filter-box {
    display: flex;
    justify-content: center;
    gap: 25px;
    flex-wrap: wrap;
    margin-bottom: 18px;
}

/* Tá»«ng nhÃ³m filter (Stream | Loáº¡i giáº£i) */
.filter-group {
    background: rgba(255,255,255,0.25) !important;
    padding: 12px 18px;
    border-radius: 12px;
    backdrop-filter: blur(6px);
    border: 1px solid rgba(255,255,255,0.5);
    min-width: 140px;
}

.filter-title {
    text-align: center;
    margin-bottom: 8px;
    font-weight: 700;
    font-size: 0.95em;
    color: #fff !important;
    text-shadow: 1px 1px 2px black;
}

/* Ã” filter */
.filter-item {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 6px 8px;
    cursor: pointer;
    margin: 4px;
    border-radius: 8px;
    background: rgba(255,255,255,0.45) !important;
    transition: .25s;
}

.filter-item:hover {
    background: rgba(255,255,255,0.32);
    transform: translateY(-2px);
}

.filter-item {
    position: relative;
}

.filter-item::after {
    content: attr(data-type);
    position: absolute;
    bottom: 100%;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(0,0,0,0.9);
    color: white;
    padding: 6px 10px;
    border-radius: 6px;
    font-size: 0.85em;
    font-weight: 600;
    white-space: nowrap;
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.2s ease;
    z-index: 100;
    margin-bottom: 8px;
}

.filter-item:hover::after {
    opacity: 1;
}

.filter-item input {
    transform: scale(1.1);
}

/* Icon stream lá»›n */
.stream-icon-big {
    font-size: 1.4em;
}

/* TAG style (thá»«a hÆ°á»Ÿng mÃ u tá»«ng loáº¡i) */
.filter-item .tag {
    display: inline-block;
    padding: 2px 6px;
    border-radius: 6px;
    font-weight: 700;
    font-size: 0.75em;
}

/* â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” MOBILE MODE â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” */
@media(max-width:768px){
    .calendar{ grid-template-columns:1fr; }
    .header-row{ display:none; }
    .day{ padding:8px 10px; min-height: 70px !important; border-radius: 6px; }
    .day-number{ font-size:1.1em !important; margin-bottom: 4px; }
}



/* â€”â€”â€”â€”â€”â€”â€”â€”â€” STATUS â€”â€”â€”â€”â€”â€”â€”â€”â€” */
/* Status indicates the *color/tint* of the note, while the left border is
    owned by the event TYPE. We apply a subtle tinted overlay on top of the
    type background to indicate status (not-started / ongoing / finished). */
.note.status-not-started { box-shadow: inset 0 0 0 9999px var(--status-not-started-rgba); }
.note.status-ongoing { box-shadow: inset 0 0 0 9999px var(--status-ongoing-rgba), 0 6px 12px rgba(27,94,32,0.06); }
.note.status-finished { box-shadow: inset 0 0 0 9999px var(--status-finished-rgba); opacity: 0.65; filter: grayscale(0.05); }

/* visual note state */
.note.status-not-started { opacity: 1; }

</style>
</head>

<body>

<h2 style="text-align:center;color:white;text-shadow:1px 1px 4px black;margin-bottom:15px;">
    Lá»ŠCH THÃNG 12
</h2>

<div class="filter-box">

    <div class="filter-group">
        <div class="filter-title">Stream</div>
        <label class="filter-item stream-filter" data-type="CÃ³ stream">
            <input type="checkbox" class="filter-stream" checked>
            <span class="stream-icon-big">ğŸ“º</span>
        </label>
        <label class="filter-item" data-type="KhÃ´ng stream">
            <input type="checkbox" class="filter-stream-no" checked>
            <span class="stream-icon-big">ğŸš«</span>
        </label>
    </div>

    <div class="filter-group">
        <div class="filter-title">Loáº¡i Giáº£i</div>

        <label class="filter-item" data-type="ocg">
            <input type="checkbox" class="filter" value="ocg" checked>
            <span class="tag ocg">OCG</span>
        </label>

        <label class="filter-item" data-type="ae">
            <input type="checkbox" class="filter" value="ae" checked>
            <span class="tag ae">AE</span>
        </label>

        <label class="filter-item" data-type="genesys">
            <input type="checkbox" class="filter" value="genesys" checked>
            <span class="tag genesys">GNS</span>
        </label>

        <label class="filter-item" data-type="nexus">
            <input type="checkbox" class="filter" value="nexus" checked>
            <span class="tag nexus">1103</span>
        </label>

        <label class="filter-item" data-type="edison">
            <input type="checkbox" class="filter" value="edison" checked>
            <span class="tag edison">E</span>
        </label>

        <label class="filter-item" data-type="tour">
            <input type="checkbox" class="filter" value="tour" checked>
            <span class="tag tour">TOUR</span>
        </label>

        <label class="filter-item" data-type="hof">
            <input type="checkbox" class="filter" value="hof" checked>
            <span class="tag hof">HOF</span>
        </label>

    </div>
</div>


<div class="header-row">
    <div class="header-cell">T2</div>
    <div class="header-cell">T3</div>
    <div class="header-cell">T4</div>
    <div class="header-cell">T5</div>
    <div class="header-cell">T6</div>
    <div class="sat">T7</div>
    <div class="sun">CN</div>
</div>

<div class="calendar" id="calendar"></div>
<div id="popup-area"></div>
<div id="preview" class="preview-box"></div>

<script>
/* â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” EVENT DATA â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” */

const TYPE_ICONS = {
    ocg: "OCG",
    ae: "AE",
    tnt: "TNT", // KhÃ´ng cÃ³ trong data events nhÆ°ng giá»¯ láº¡i Ä‘á»ƒ phÃ²ng há»
    genesys: "GNS",
    nexus: "1103",
    edison: "E",
    tour: "TOUR",
    hof: "HOF"
};

// events: each item can have optional `stream` (boolean) and `streamUrl` (string) to show a watch link in the popup
const events = [
    { day:7, name:"Mahado Nexus", type:"nexus", stream:false, time:"14:30", finished: true },
    { day:21, name:"Mahado Edison", type:"edison", stream:false, time:"14:30", finished: true },
    { day:9, name:"TNT Genesys", type:"genesys", stream:false, time:"14:30", finished: true },
    { day:14, name:"Mahado AE Open", type:"ae", stream:false, time:"10:00 "},
    { day:27, name:"Mahado HoF Kickoff", type:"hof", stream:true, time:"13:00", streamUrl: "https://example.com/watch" },
    { day:28, name:"Anh BÃ¬nh Tournament", type:"tour", stream:false, time:"14:30" },

    /* Converted weekly TNT OCG (Tuesdays) -> explicit day entries */
    { day:2, name:"TNT OCG", type:"ocg", stream:true, time:"18:00", finished: true, streamUrl: "https://www.youtube.com/watch?v=VZYrdL0S7Ds" },
    { day:16, name:"TNT OCG", type:"ocg", stream:true, time:"18:00" },
    { day:23, name:"TNT OCG", type:"ocg", stream:true, time:"18:00" },
    { day:30, name:"TNT OCG", type:"ocg", stream:true, time:"18:00" },

    /* Converted weekly OCG Open (Saturdays) -> explicit day entries */
    { day:6, name:"Mahado OCG Open", type:"ocg", stream:false, time:"14:00", finished: true },
    { day:13, name:"Mahado OCG Open", type:"ocg", stream:false, time:"14:00", finished: true },
    { day:20, name:"Mahado OCG Open", type:"ocg", stream:false, time:"14:00" }
];

/* â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” BUILDING THE CALENDAR â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” */

const calendarElement = document.getElementById("calendar");
const popupArea = document.getElementById("popup-area");

const today = new Date();
today.setHours(0,0,0,0);

// Thiáº¿t láº­p thÃ¡ng vÃ  nÄƒm cho lá»‹ch (Hiá»‡n táº¡i lÃ  ThÃ¡ng 12)
const year = today.getFullYear();
const month = 11; // 0 = Jan, 11 = Dec

// Image configuration (change these if you move image folders)
const IMAGE_ROOT = '/data/image';
const IMAGE_MONTH = 'Dec';

const firstDay = new Date(year, month, 1).getDay(); // 0=CN, 1=T2, ...
const daysInMonth = new Date(year, month+1, 0).getDate();

// Báº¯t Ä‘áº§u tá»« T2 (1), T3 (2), ... CN (0) chuyá»ƒn thÃ nh T2 (0), T3 (1), ... CN (6)
const startIndex = firstDay === 0 ? 6 : firstDay - 1;
const totalCells = Math.ceil((daysInMonth + startIndex)/7)*7;

const KNOWN_TYPES = Object.keys(TYPE_ICONS);

// Tá»‘i Æ°u hÃ³a: Táº¡o cÃ¡c Ã´ lá»‹ch trong DocumentFragment (bá»™ nhá»›)
const fragment = document.createDocumentFragment();
for(let i=0;i<totalCells;i++){
    const cell = document.createElement("div");
    cell.className = "day";
    fragment.appendChild(cell);
}
calendarElement.appendChild(fragment);

const cells = document.querySelectorAll(".day");

/* â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” PLACE DATES â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” */
cells.forEach((cell,i)=>{
    const d = i - startIndex + 1;

    if(d < 1 || d > daysInMonth){
        cell.classList.add("other");
        return;
    }

    const date = new Date(year,month,d);
    cell.innerHTML = `<div class="day-number">${d}</div>`;

    // Sá»­a lá»—i: So sÃ¡nh ngÃ y hÃ´m qua/hÃ´m nay pháº£i so sÃ¡nh cáº£ thÃ¡ng/nÄƒm
    const isPast = date < today;
    const isToday = (
        d === today.getDate() && 
        month === today.getMonth() && 
        year === today.getFullYear()
    );

    if(isPast) cell.classList.add("past");
    if(isToday) cell.classList.add("today");

    addEventsToCell(d, cell, date);
});

/* â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” RENDER EVENTS â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” */
function addEventsToCell(day, cell, date){
    // DayOfWeek: 0=CN, 1=T2, ... 6=T7
    const weekday = new Date(year,month,day).getDay(); 
    // Week Number: tuáº§n 1, 2, 3, 4, 5 cá»§a thÃ¡ng
    const weekNum = Math.ceil((day+startIndex)/7);

    events.forEach(ev=>{
        if(ev.weekly){
            // Chuyá»ƒn weekday cá»§a JS (0-6) vá» format cá»§a user (1-7, 0=CN thÃ¬ thÃ nh 7)
            const standardWeekday = weekday === 0 ? 7 : weekday;

            if(ev.weekday === standardWeekday && ev.weeks.includes(weekNum)){
                createNote(ev, cell, date);
            }
        } else if(ev.day === day){
            createNote(ev, cell, date);
        }
    });
}

/* â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” CREATE NOTE ELEMENT â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” */
function createNote(ev, cell, date){
    const box = document.createElement("div");
    box.className = `note ${ev.type}`;

    // Stream icon (camera) if stream = true
    if(ev.stream){
        const cam = document.createElement("span");
        cam.className = "stream-icon";
        cam.textContent = "ğŸ“º";
        box.appendChild(cam);
    }

    // Optional start time is shown only in popup / preview (not in the note UI)

    // Name only (no parentheses)
    const name = document.createElement("span");
    name.className = 'name';
    name.textContent = ev.name;
    box.appendChild(name);

    // Type icon according to custom table (badge on right)
    const tag = document.createElement("span");
    tag.className = "tag";
    tag.textContent = TYPE_ICONS[ev.type] || ev.type.toUpperCase();
    box.appendChild(tag);

    box.onclick = (e) => showPopup(ev, e);
    box.onmouseover = (e) => showPreview(ev, e);
    box.onmousemove = movePreview;
    box.onmouseleave = hidePreview;

    // compute start timestamp if time is provided
    let startMs = 0;
    if(ev.time && date){
        const [hh, mm] = ev.time.split(':').map(s => Number(s));
        const startDate = new Date(date.getFullYear(), date.getMonth(), date.getDate(), hh || 0, mm || 0);
        startMs = startDate.getTime();
        box.dataset.start = String(startMs);
    } else if(date){
        // use start of day (midnight) if no time specified
        const startDate = new Date(date.getFullYear(), date.getMonth(), date.getDate(), 0, 0, 0);
        startMs = startDate.getTime();
        box.dataset.start = String(startMs);
    }

    // compute and store status-related data attributes
    // default finished to false if not provided; allow localStorage overrides
    const key = getFinishKey(ev, startMs);
    let finished = !!ev.finished;
    try{ const persisted = localStorage.getItem(key); if(persisted !== null) finished = persisted === 'true'; }catch(e){ }
    box.dataset.finished = finished ? 'true' : 'false';

    // compute and set status class only; we don't add textual badges to notes.
    const status = computeEventStatus(startMs, finished);
    // set the status class on the note (affects border and visual state)
    box.classList.add(status.class);
    // accessibility: expose aria label with status and make the note keyboard-focusable
    box.setAttribute('aria-label', `${ev.name} â€” ${status.label}`);
    box.tabIndex = 0;
    box.onkeydown = (evKey) => { if(evKey.key === 'Enter' || evKey.key === ' ') showPopup(ev, { currentTarget: box, clientX: box.getBoundingClientRect().left + 10, clientY: box.getBoundingClientRect().top + 10 }); };
    // No textual badge appended - notes will indicate status via color/border.
    cell.appendChild(box);
}

/* â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” POPUP â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” */
function showPopup(ev, e){
    // Render popup HTML
    // compute status using the clicked element dataset if available; fall back to event data
    const startMs = Number(e?.currentTarget?.dataset?.start || 0);
    const persistedFinished = e?.currentTarget?.dataset?.finished === 'true';
    const finished = persistedFinished || !!ev.finished;
    const status = computeEventStatus(startMs, finished);

    // Render only the first page when not finished; include extra pages when finished
    const firstPage = `
                <div class="page" data-index="0">
                    <div class="front">
                        <h3>${ev.name}</h3>
                        <div class="popup-row"><span class="label">Thá»i gian</span><span class="value"><b>${ev.time || 'TBA'}</b></span></div>
                        <div class="popup-row"><span class="label">Tráº¡ng thÃ¡i</span><span class="value" id="popup-status"><b>${status.label}</b></span></div>
                        <div class="popup-row"><span class="label">Format</span><span class="value"><span class="tag ${ev.type}">${TYPE_ICONS[ev.type] || ev.type.toUpperCase()}</span></span></div>
                        <div class="popup-row"><span class="label">Stream</span><span class="value">${ev.stream ? 'ğŸ“º CÃ³ stream' : 'ğŸš« KhÃ´ng stream'}${ev.streamUrl ? ` <a class="watch-btn" href="${ev.streamUrl}" target="_blank" rel="noopener">Xem</a>` : ''}</span></div>
                    </div>
                    <div class="back">
                        Format: <b>${ev.type.toUpperCase()}</b>
                    </div>
                </div>`;

    const extraPages = `
                <div class="page" data-gallery="true">
                    <div class="front">
                        <h4>HÃ¬nh áº£nh</h4>
                        <div class="gallery" aria-live="polite">Táº£i áº£nh...</div>
                    </div>
                </div>

                <div class="page">
                    <div class="front">ThÃ´ng tin thÃªm</div>
                    <div class="back">
                        Event ngÃ y: ${ev.day ? ev.day : "HÃ ng tuáº§n"}
                    </div>
                </div>`;

    popupArea.innerHTML = `
    <div class="popup-bg" onclick="closePopup()">
        <div class="book-popup" role="dialog" aria-modal="true" onclick="event.stopPropagation()">

            <div class="book">
                <div class="page-view" role="group" aria-label="Popup pages">
                    ${firstPage}
                    ${finished ? extraPages : ''}
                </div>
            </div>

            <div class="close-book">
                <button id="popup-prev" aria-label="Trang trÆ°á»›c">â€¹</button>
                <button id="popup-next" aria-label="Trang sau">â€º</button>
                <button id="popup-close-btn">ÄÃ³ng</button>
            </div>

        </div>
    </div>`;

    // Prevent background scroll
    document.body.style.overflow = 'hidden';

    // Add keyboard handler for Escape
    const onKey = (e) => { if(e.key === 'Escape') closePopup(); };
    document.addEventListener('keydown', onKey);
    // store handler so we can remove it later
    popupArea._onKey = onKey;

    // Animate in by adding .show classes after render
    const popupBg = popupArea.querySelector('.popup-bg');
    const bookPopup = popupArea.querySelector('.book-popup');
    requestAnimationFrame(()=>{
        popupBg && popupBg.classList.add('show');
        bookPopup && bookPopup.classList.add('show');
    });

    // Attach close button
    const closeBtn = popupArea.querySelector('#popup-close-btn');
    closeBtn?.addEventListener('click', closePopup);

    // Setup page navigation (prev/next buttons)
    (function setupNavigation(){
        const pageView = popupArea.querySelector('.page-view');
        if(!pageView) return;
        const pages = Array.from(pageView.querySelectorAll('.page'));
        // mark first as active
        pages.forEach((p, idx) => p.classList.toggle('active', idx === 0));

        const prevBtn = popupArea.querySelector('#popup-prev');
        const nextBtn = popupArea.querySelector('#popup-next');

        let current = 0;
        function showIndex(i){
            if(i < 0) i = 0;
            if(i > pages.length - 1) i = pages.length - 1;
            current = i;
            pages.forEach((p, idx) => p.classList.toggle('active', idx === current));
            if(prevBtn) prevBtn.disabled = current === 0;
            if(nextBtn) nextBtn.disabled = current === pages.length - 1;
        }

        if(prevBtn) prevBtn.addEventListener('click', ()=> showIndex(current - 1));
        if(nextBtn) nextBtn.addEventListener('click', ()=> showIndex(current + 1));

        // hide navigation if only one page
        if(pages.length <= 1){
            prevBtn && (prevBtn.style.display = 'none');
            nextBtn && (nextBtn.style.display = 'none');
        } else {
            // keyboard navigation (left/right)
            const onNavKey = (evt) => {
                if(evt.key === 'ArrowLeft') showIndex(current - 1);
                if(evt.key === 'ArrowRight') showIndex(current + 1);
            };
            document.addEventListener('keydown', onNavKey);
            popupArea._onNavKey = onNavKey;
            // initialize buttons state
            showIndex(0);
        }
    })();

    // initialize gallery if present: fetch images for this event's day
    (async function initGallery(){
        const galleryPage = popupArea.querySelector('.page[data-gallery="true"]');
        if(!galleryPage) return;
        const galleryEl = galleryPage.querySelector('.gallery');
        if(!galleryEl) return;

        const day = ev.day;
        if(!day){
            galleryEl.innerHTML = '<div class="empty">KhÃ´ng cÃ³ thÆ° má»¥c áº£nh cho sá»± kiá»‡n nÃ y.</div>';
            return;
        }

        try{
            let imgs = await fetchImagesForDay(day);
            if(!imgs || imgs.length === 0){
                galleryEl.innerHTML = '<div class="empty">KhÃ´ng tÃ¬m tháº¥y áº£nh.</div>';
                return;
            }
            // limit to reasonable number
            imgs = imgs.slice(0,20);

            galleryEl.innerHTML = '';
            imgs.forEach(src => {
                const img = document.createElement('img');
                img.src = src;
                img.alt = ev.name + ' - áº£nh';
                img.loading = 'lazy';
                img.addEventListener('click', ()=> window.open(src, '_blank'));
                galleryEl.appendChild(img);
            });
        } catch(err){
            galleryEl.innerHTML = '<div class="empty">Lá»—i khi táº£i áº£nh.</div>';

        }
    })();

    // No toggle button in the popup â€” finished state is managed in-code and via persistence.
}

function closePopup(){
    const popupBg = popupArea.querySelector('.popup-bg');
    const bookPopup = popupArea.querySelector('.book-popup');

    // Remove show classes to trigger hide animation
    popupBg && popupBg.classList.remove('show');
    bookPopup && bookPopup.classList.remove('show');

    // Restore scroll and remove key handler
    document.body.style.overflow = '';
    if(popupArea._onKey) document.removeEventListener('keydown', popupArea._onKey);
    popupArea._onKey = null;
    if(popupArea._onNavKey) document.removeEventListener('keydown', popupArea._onNavKey);
    popupArea._onNavKey = null;
    // No toggle button cleanup required (finished state is managed in code).

    // Wait for CSS transition to finish before removing DOM
    setTimeout(()=>{ popupArea.innerHTML = ''; }, 260);
}

/* flipPage removed â€” navigation uses prev/next buttons now */

/* â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” FILTER â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” */
document.querySelector(".filter-stream")?.addEventListener("change", applyFilter);
document.querySelector(".filter-stream-no")?.addEventListener("change", applyFilter);
document.querySelectorAll(".filter").forEach(chk=>{
    chk.addEventListener("change", applyFilter);
});

// attach stream checkbox to trigger same applyFilter
const streamCheckbox = document.querySelector(".filter-stream");
if(streamCheckbox) streamCheckbox.addEventListener("change", applyFilter);


// main applyFilter: combines type filters + stream filter
function applyFilter() {

    // Láº¥y tráº¡ng thÃ¡i filter loáº¡i giáº£i
    const selectedTypes = {};
    document.querySelectorAll(".filter").forEach(chk=>{
        selectedTypes[chk.value] = chk.checked;
    });

    // Láº¥y tráº¡ng thÃ¡i filter stream má»›i
    const showStream = document.querySelector(".filter-stream").checked;
    const showNoStream = document.querySelector(".filter-stream-no").checked;

    const isMobile = window.innerWidth <= 768;

    document.querySelectorAll(".day").forEach(day => {
        const notes = [...day.querySelectorAll(".note")];
        let visibleCount = 0;

        notes.forEach(n => {
            const nType = [...n.classList].find(c => KNOWN_TYPES.includes(c));
            const hasStream = !!n.querySelector(".stream-icon");

            let visible = true;

            // 1) Lá»c theo loáº¡i
            if(nType) visible = selectedTypes[nType];

            // 2) Lá»c theo Stream má»›i
            if(hasStream && !showStream) visible = false;
            if(!hasStream && !showNoStream) visible = false;

            // Display
            n.style.display = visible ? "flex" : "none";
            if(visible) visibleCount++;
        });

        // Mobile áº©n ngÃ y khÃ´ng cÃ³ sá»± kiá»‡n
        if(isMobile){
            day.style.display = visibleCount > 0 ? "flex" : "none";
        } else {
            day.style.display = "";
        }
    });
}

const previewBox = document.getElementById("preview");

function showPreview(ev, e) {
    const streamText = ev.stream ? "ğŸ“º CÃ³ stream" : "ğŸš« KhÃ´ng stream";
    const typeName = ev.type.toUpperCase();

    // compute status using the note's dataset (if available)
    const startMs = Number(e.currentTarget?.dataset?.start || 0);
    const finished = e.currentTarget?.dataset?.finished === 'true';
    const status = computeEventStatus(startMs, finished);
    previewBox.innerHTML = `
        <b>${ev.name}</b><br>
        Thá»i gian: ${ev.time || 'TBA'}<br>
        Tráº¡ng thÃ¡i: ${status.label}<br>
        Format: <span class="tag ${ev.type}">${TYPE_ICONS[ev.type] || typeName}</span><br>
        ${streamText}
    `;

    const x = e.clientX + 14;
    const y = e.clientY + 14;

    previewBox.style.left = x + "px";
    previewBox.style.top = y + "px";

    previewBox.classList.add("show");
}

function movePreview(e){
    previewBox.style.left = (e.clientX + 14) + "px";
    previewBox.style.top  = (e.clientY + 14) + "px";
}

function hidePreview(){
    previewBox.classList.remove("show");
}

// â€”â€”â€”â€”â€” STATUS â€”â€”â€”â€”â€”
function computeEventStatus(startMs, finished){
    const now = Date.now();
    if(finished) return { label: 'ÄÃ£ káº¿t thÃºc', class: 'status-finished' };
    if(!startMs) return { label: 'ChÆ°a báº¯t Ä‘áº§u', class: 'status-not-started' };
    if(now < startMs) return { label: 'ChÆ°a báº¯t Ä‘áº§u', class: 'status-not-started' };
    // started and not finished
    return { label: 'Äang diá»…n ra', class: 'status-ongoing' };
}

// helper for persistence key per event occurrence
function getFinishKey(ev, startMs){
    // Use startMs + type + name for uniqueness
    return `finished:${startMs}|${ev.type}|${encodeURIComponent(ev.name)}`;
}

function updateAllStatuses(){
    document.querySelectorAll('.note').forEach(note => {
        const startMs = Number(note.dataset.start || 0);
        const finished = note.dataset.finished === 'true';
        const status = computeEventStatus(startMs, finished);
        // We no longer display textual status badges on notes.
        // update note classes
        note.classList.remove('status-not-started', 'status-ongoing', 'status-finished');
        note.classList.add(status.class);
        // update aria-label/title for accessibility
        const nameEl = note.querySelector('.name');
        const nameText = nameEl ? nameEl.textContent : '';
        note.setAttribute('aria-label', `${nameText} â€” ${status.label}`);
        note.title = `${nameText} â€” ${status.label}`;
    })
}

// Try to discover images for a given day under `${IMAGE_ROOT}/${IMAGE_MONTH}/${day}`
// Strategy (preferred):
// 1) `index.json` file inside the folder containing a JSON array of filenames (fastest)
// 2) Directory listing (if your server exposes autoindex)
// 1) index.json
async function fetchImagesForDay(day){
    const base = `${IMAGE_ROOT}/${IMAGE_MONTH}/${day}/`;
    // 1) index.json
    try{
        
        const idx = await fetch(base + 'index.json');
        if(idx.ok){
            const arr = await idx.json();

            if(Array.isArray(arr) && arr.length) return arr.map(s => {
                if(s.startsWith('http')) return s;
                if(s.startsWith('/')) return s;
                return base + s.replace(/^\/?/, '');
            });
        } else {

        }
    } catch(e){ /* ignore */ }

    // 2) try directory listing
    try{
        
        const dir = await fetch(base);
        if(dir.ok){
            const text = await dir.text();
            // look for hrefs
            const urls = [];
            const re = /href\s*=\s*\"([^\"]+\.(?:jpg|jpeg|png|webp|gif))\"/ig;
            let m;
            while((m = re.exec(text)) !== null){
                let href = m[1];
                // if href is relative, join with base
                if(!href.startsWith('http')) href = base + href.replace(/^\/?/, '');
                urls.push(href);
            }

            if(urls.length) return urls;
        } else {

        }
    } catch(e){ /* ignore */ }

    // 3) probe common numbered filenames
    const exts = ['jpg','jpeg','png','webp','gif'];
    const found = [];
    for(let i=1;i<=20;i++){
        for(const ext of exts){
            const url = `${base}${i}.${ext}`;
            try{
                const res = await fetch(url, { method: 'HEAD' });
                if(res.ok){ found.push(url); }
            } catch(e){ /* ignore */ }
        }
        if(found.length >= 12) break; // don't probe forever
    }

    return found;
}

// Update statuses every 30s
setInterval(updateAllStatuses, 30 * 1000);

/* â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” AUTO FILTER ON LOAD & RESIZE â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” */

// 1. Cháº¡y bá»™ lá»c khi táº£i trang (Ä‘áº·c biá»‡t cho mobile)
applyFilter();
// 1.1 Update event statuses based on current time
updateAllStatuses();

// 2. Xá»­ lÃ½ thay Ä‘á»•i kÃ­ch thÆ°á»›c mÃ n hÃ¬nh mÃ  KHÃ”NG reload trang
window.addEventListener("resize", () => {
    // Sá»­ dá»¥ng Debounce Ä‘á»ƒ giá»›i háº¡n sá»‘ láº§n gá»i applyFilter khi kÃ©o chuá»™t liÃªn tá»¥c
    if(window.resizeTimer) clearTimeout(window.resizeTimer);
    window.resizeTimer = setTimeout(() => {
        applyFilter();
    }, 200);
});
</script>
</body>
</html>